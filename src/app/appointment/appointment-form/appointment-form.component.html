<div *ngIf="showForm" class="overlay">
  <div class="appointment-modal">
    <!-- Header Section -->
    <form [formGroup]="appointmentForm">
      <div class="appointment-header">
        <h3>Appointment Form</h3>
        <button class="close-button" (click)="closeForm($event)">&#10006;</button>
      </div>

      <!-- Form Fields -->
      <div class="form-content">
        <!-- Patient Name -->
        <div class="form-group">
          <label>Patient Name:</label>
          <input type="text" placeholder="First Name" formControlName="firstName" />
          <div *ngIf="appointmentForm.get('firstName')?.invalid && (appointmentForm.get('firstName')?.touched || appointmentForm.get('firstName')?.dirty)">
            <small *ngIf="appointmentForm.get('firstName')?.errors?.['required']">First Name is required</small>
            <small *ngIf="appointmentForm.get('firstName')?.errors?.['pattern']">First Name can only contain letters and spaces</small>
          </div>
          
          <input type="text" placeholder="Last Name" formControlName="lastName" />
          <div *ngIf="appointmentForm.get('lastName')?.invalid && (appointmentForm.get('lastName')?.touched || appointmentForm.get('lastName')?.dirty)">
            <small *ngIf="appointmentForm.get('lastName')?.errors?.['required']">Last Name is required</small>
            <small *ngIf="appointmentForm.get('lastName')?.errors?.['pattern']">Last Name can only contain letters, spaces, and dots</small>
          </div>
        </div>

        <!-- Phone Number -->
        <div class="form-group">
          <label>Phone Number:</label>
          <input type="text" placeholder="Enter the 10 digit phone number" maxlength="10" formControlName="phoneNumber" />
          <div *ngIf="appointmentForm.get('phoneNumber')?.invalid && (appointmentForm.get('phoneNumber')?.touched || appointmentForm.get('phoneNumber')?.dirty)">
            <small *ngIf="appointmentForm.get('phoneNumber')?.errors?.['required']">Phone Number is required</small>
            <small *ngIf="appointmentForm.get('phoneNumber')?.errors?.['pattern']">Phone Number must be 10 digits</small>
          </div>
        </div>

        <!-- Email -->
        <div class="form-group">
          <label>Email Id:</label>
          <input type="email" placeholder="abcd@gmail.com" formControlName="email" />
          <div *ngIf="appointmentForm.get('email')?.invalid && (appointmentForm.get('email')?.touched || appointmentForm.get('email')?.dirty)">
            <small *ngIf="appointmentForm.get('email')?.errors?.['required']">Email is required</small>
            <small *ngIf="appointmentForm.get('email')?.errors?.['email']">Invalid email address</small>
          </div>
        </div>

        <!-- Doctor Name -->
        <div class="form-group">
          <label>Doctor Name:</label>
          <input type="text" placeholder="Dr. Atmaram" formControlName="doctorName" (input)="onDoctorNameInput()" (focus)="showDoctorSuggestions = true" />
          <ul class="doctor-suggestions" *ngIf="showDoctorSuggestions && filteredDoctors.length > 0">
            <li *ngFor="let doctor of filteredDoctors" (click)="onDoctorSelect(doctor)">
              {{ doctor.name }}
            </li>
          </ul>
          <div *ngIf="appointmentForm.get('doctorName')?.invalid && (appointmentForm.get('doctorName')?.touched || appointmentForm.get('doctorName')?.dirty)">
            <small *ngIf="appointmentForm.get('doctorName')?.errors?.['required']">Doctor Name is required</small>
            <small *ngIf="appointmentForm.get('doctorName')?.errors?.['pattern']">Doctor Name can only contain letters, spaces, and dots</small>
          </div>
        </div>

        <!-- Appointment Date and Time -->
        <div class="appointment-timing">
          <div class="form-group time">
            <label>Appointment Date:</label>
            <input type="date" formControlName="appointmentDate" [min]="minDate" />
            <div *ngIf="appointmentForm.get('appointmentDate')?.invalid && appointmentForm.get('appointmentDate')?.touched">
              <small>Appointment Date is required</small>
            </div>
          </div>

          <div class="form-group time slot">
            <label>Appointment Time:</label>
            <select formControlName="appointmentTime">
              <option value="" selected *ngIf="availableSlots.length === 0">No available slots</option>
              <option *ngFor="let slot of availableSlots" [value]="slot">
                {{ slot }}
              </option>
            </select>
            <div *ngIf="appointmentForm.get('appointmentTime')?.invalid && appointmentForm.get('appointmentTime')?.touched">
              <small>Appointment Time is required</small>
            </div>
          </div>
        </div>

        <!-- Request Via -->
        <div class="appointment-timing">
          <div class="form-group form-group-2">
            <label class="radio">Request Via:</label>
            <div class="radio-group">
              <label><input type="radio" formControlName="requestVia" value="Website" /> Website</label>
              <label><input type="radio" formControlName="requestVia" value="Call" /> Call</label>
              <label><input type="radio" formControlName="requestVia" value="Walk-In" /> Walk-In</label>
            </div>
          </div>

          <!-- Appointment Status -->
          <div class="form-group form-group-2">
            <label class="radio">Appointment:</label>
            <div class="radio-group">
              <label><input type="radio" formControlName="appointmentStatus" value="Confirm" /> Confirm</label>
              <label><input type="radio" formControlName="appointmentStatus" value="Cancel" /> Cancel</label>
            </div>
          </div>
        </div>

        <!-- Buttons -->
        <div class="button-group">
          <button class="btn-primary" [disabled]="!appointmentForm.valid" (click)="confirm()">Book Appointment</button>
        </div>
      </div>
    </form>
  </div>
</div>
